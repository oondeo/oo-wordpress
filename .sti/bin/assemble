#!/bin/bash -e

if [ -e /usr/local/sti/assemble ]; then
  # old assemble location in previous php image versions
  source /usr/local/sti/assemble
else 
  source ${STI_SCRIPTS_PATH}/assemble
fi

#[[ -d ./app/tmp ]] && chmod -R go+rw ./app/tmp

# Get access to `cake` shell command for generating DB schema and migrations
if [ -f ${HOME}/vendor/wp-cli/wp ]; then
	ln -s ${HOME}/vendor/wp-cli/wp ${HOME}/bin/wp
fi

wp core config --dbname=${MYSQL_DATABASE} --dbuser=${MYSQL_USER} --dbpass=${MYSQL_PASSWORD} \
  --dbhost=${DATABASE_SERVICE_NAME}_${SERVICE_HOST} 
wp core install --url=${APPLICATION_DOMAIN} --title={APPLICATION_DOMAIN} --admin_user={WP_ADMIN_USER} \
  --admin_password=${WP_ADMIN_PASSWORD} --admin_email=${WP_ADMIN_EMAIL}  --skip-email